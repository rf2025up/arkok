import{j as e,r as i,c as R}from"./client-C_2d_5tV.js";const A=({wsConnected:t=!1})=>e.jsxs("header",{className:"text-center flex-shrink-0 mb-2 flex items-center justify-between",children:[e.jsx("div",{}),e.jsx("h1",{className:"text-3xl sm:text-4xl font-bold tracking-tighter flex-1",children:e.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-500",children:"æ˜Ÿé€”æˆé•¿æ–¹èˆŸ"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${t?"bg-green-500 animate-pulse":"bg-red-500"}`}),e.jsx("span",{className:"text-sm text-gray-400",children:t?"æ•°æ®åŒæ­¥ä¸­":"ç¦»çº¿"})]})]}),k=({title:t,children:s,rightSlot:x})=>e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700/50 rounded-xl shadow-lg h-full flex flex-col",children:[e.jsxs("div",{className:"grid grid-cols-3 items-center px-3 py-3 border-b border-slate-700/50 flex-shrink-0",children:[e.jsx("div",{}),e.jsx("div",{className:"text-xl font-bold text-center",children:t}),e.jsx("div",{className:"justify-self-end",children:x})]}),e.jsx("div",{className:"p-2 sm:p-3 overflow-y-auto flex-grow min-h-0",children:s})]}),I=t=>{const s=v=>Math.floor(100*Math.pow(1.25,Math.max(0,v-1)));let x=0,l=1;for(;t-x>=s(l);)x+=s(l),l+=1;const d=s(l),m=Math.max(0,Math.min(1,(t-x)/d));return{level:l,progress:Math.round(m*100)}},E=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:"currentColor",...t,children:e.jsx("path",{d:"M313.4 32.9c26-5.2 42.9 20.5 37.7 46.5l-2.3 11.4c-5.3 26.7-15.1 52.1-28.8 75.2H464c26.5 0 48 21.5 48 48c0 18.5-10.5 34.6-25.9 42.6C497 275.4 502 288.9 502 304c0 23.4-16.8 42.9-38.9 47.1c4.4 7.3 6.9 15.8 6.9 24.9c0 21.3-13.9 39.4-33.1 45.6c.7 3.3 1.1 6.8 1.1 10.4c0 26.5-21.5 48-48 48H128c-26.5 0-48-21.5-48-48c0-3.6 .4-7.1 1.1-10.4C62.9 457.4 49 439.3 49 418c0-9.1 2.5-17.6 6.9-24.9C33.8 388.9 17 369.4 17 348c0-15.1 5-28.6 13.9-39.4C10.5 298.6 0 282.5 0 264c0-26.5 21.5-48 48-48h143.6c-13.7-23.1-23.5-48.5-28.8-75.2l-2.3-11.4c-5.2-26 11.7-51.7 37.7-46.5l24.1 4.8c12.1 2.4 24.1 2.4 36.2 0l24.1-4.8z"})}),B=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-5 h-5",children:[e.jsx("path",{d:"M9.25 13.25a.75.75 0 0 0 1.5 0V4.636l2.955 3.129a.75.75 0 0 0 1.09-1.03l-4.25-4.5a.75.75 0 0 0-1.09 0l-4.25 4.5a.75.75 0 1 0 1.09 1.03L9.25 4.636v8.614Z"}),e.jsx("path",{d:"M3.5 12.75a.75.75 0 0 0-1.5 0v2.5A2.75 2.75 0 0 0 4.75 18h10.5A2.75 2.75 0 0 0 18 15.25v-2.5a.75.75 0 0 0-1.5 0v2.5c0 .69-.56 1.25-1.25 1.25H4.75c-.69 0-1.25-.56-1.25-1.25v-2.5Z"})]}),P=({student:t,onAvatarChange:s,className:x})=>{const l=i.useRef(null),d=m=>{var N;const v=(N=m.target.files)==null?void 0:N[0];if(!v)return;if(v.size>1024*1024){alert("å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡ 1MB");return}const w=new FileReader;w.onload=b=>{var j;const g=(j=b.target)==null?void 0:j.result;typeof g=="string"&&s(t.id,g)},w.readAsDataURL(v)};return e.jsxs("div",{className:`relative group flex-shrink-0 ${x}`,onClick:()=>{var m;return(m=l.current)==null?void 0:m.click()},children:[e.jsx("img",{src:t.avatar_url,alt:t.name,className:"w-full h-full rounded-full object-cover group-hover:opacity-60 transition-opacity"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer",children:e.jsx(B,{})}),e.jsx("input",{type:"file",ref:l,className:"hidden",accept:"image/png, image/jpeg, image/webp",onChange:d})]})},T=({student:t,team:s,onAvatarChange:x})=>{const{level:l}=I(t.total_exp);return e.jsx("div",{className:"p-3 rounded-xl mb-2 bg-gradient-to-br from-yellow-800/30 via-slate-800/20 to-slate-800/20 border-2 border-yellow-400/80",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx(P,{student:t,onAvatarChange:x,className:"w-16 h-16 border-4 border-yellow-400 shadow-lg rounded-full"}),e.jsx(E,{className:"w-8 h-8 text-yellow-300 absolute -top-3 right-0 transform rotate-12 z-20"})]}),e.jsxs("div",{className:"flex-grow relative overflow-hidden flex flex-col justify-center",children:[e.jsx("h3",{className:"text-2xl font-bold text-white relative z-10",children:t.name}),e.jsx("p",{className:`text-base font-semibold ${(s==null?void 0:s.textColor)??"text-gray-400"} relative z-10`,children:(s==null?void 0:s.name)??"æ— æˆ˜é˜Ÿ"}),e.jsx("span",{className:"absolute right-0 -bottom-4 text-7xl font-black text-white opacity-10 select-none z-0 transform",children:"NO.1"})]}),e.jsxs("div",{className:"flex-shrink-0 bg-slate-900/40 rounded-lg px-4 py-1.5 flex items-center gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-bold text-2xl text-blue-400",children:l}),e.jsx("div",{className:"text-xs text-slate-400",children:"ç­‰çº§"})]}),e.jsx("div",{className:"w-px h-10 bg-slate-700"}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-3xl font-black text-yellow-300 tracking-wider",children:t.total_exp.toLocaleString()}),e.jsx("div",{className:"text-xs text-slate-400",children:"ç»éªŒ"})]})]})]})})},z=({students:t,teamsMap:s,onAvatarChange:x})=>{const[l,d]=i.useState(0),[m,v]=i.useState(10),w=i.useRef(null),N=t[0],b=t.slice(1),g=N?s.get(N.team_id):void 0;i.useEffect(()=>{const h=w.current;if(!h||b.length===0)return;const f=new ResizeObserver(()=>{const c=h.clientHeight,r=h.querySelector("li");if(!r)return;const n=r.offsetHeight+8;if(n<=0)return;const u=window.innerWidth>=768,a=u?2:1,S=Math.max(1,Math.floor(c/n))*a;v(y=>S>0&&S!==y?u?Math.floor(S/2)*2:S:y)});return f.observe(h),()=>f.disconnect()},[b.length]);const j=i.useMemo(()=>{const h=[];if(m>0)for(let f=0;f<b.length;f+=m)h.push(b.slice(f,f+m));return h.length>0?h:[[]]},[b,m]),_=j.length;return i.useEffect(()=>{if(_<=1)return;const h=setInterval(()=>{d(f=>(f+1)%_)},5e3);return()=>clearInterval(h)},[_]),t.length===0||!N?e.jsx("div",{className:"text-center p-8 text-slate-500",children:"æš‚æ— å­¦ç”Ÿæ•°æ®"}):e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx(T,{student:N,team:g,onAvatarChange:x}),e.jsx("div",{className:"h-px bg-slate-700 my-2"}),e.jsx("div",{className:"flex-grow overflow-hidden relative",ref:w,children:e.jsx("div",{className:"flex h-full transition-transform duration-700 ease-in-out",style:{transform:`translateX(-${l*100}%)`},children:j.map((h,f)=>e.jsx("ul",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 w-full flex-shrink-0 h-full content-start",children:h.map((c,r)=>{s.get(c.team_id);const o=f*m+r+2,{level:n,progress:u}=I(c.total_exp);return e.jsxs("li",{className:"flex flex-col p-2 rounded-lg border border-slate-700/50 bg-slate-800/30 hover:bg-slate-800/50 transition-colors duration-200",children:[e.jsxs("div",{className:"flex items-center w-full",children:[e.jsx("span",{className:"text-3xl font-bold italic w-12 text-yellow-400 text-center",children:o}),e.jsx(P,{student:c,onAvatarChange:x,className:"w-8 h-8 rounded-full mr-2 border border-slate-600"}),e.jsxs("div",{className:"flex-grow overflow-hidden",children:[e.jsx("div",{className:"font-semibold text-white truncate text-sm",children:c.name}),e.jsxs("div",{className:"flex gap-x-2",children:[e.jsxs("div",{className:"text-xs text-slate-300",children:[c.total_exp.toLocaleString()," ç»éªŒ"]}),e.jsxs("div",{className:"text-xs text-slate-500",children:[c.total_points.toLocaleString()," ç§¯åˆ†"]})]})]}),e.jsx("div",{className:"text-right ml-2",children:e.jsxs("div",{className:"font-bold text-sm text-blue-400",children:["ç­‰çº§ ",n]})})]}),e.jsx("div",{className:"w-full bg-slate-700 rounded-full h-1 mt-1.5",children:e.jsx("div",{className:"bg-cyan-400 h-1 rounded-full transition-all duration-500",style:{width:`${u}%`}})})]},c.id)})},f))})})]})},H=({students:t,teams:s,sortBy:x,unit:l})=>{const d=i.useMemo(()=>{const b=new Map;return s.forEach(g=>b.set(g.id,0)),t.forEach(g=>b.set(g.team_id,(b.get(g.team_id)||0)+g[x])),Array.from(b.entries()).map(([g,j])=>({team:s.find(_=>_.id===g),total:j})).filter(g=>!!g.team).sort((g,j)=>j.total-g.total)},[t,s,x]),[m,v]=i.useState(0);i.useEffect(()=>{if(d.length<=1)return;const b=setInterval(()=>v(g=>(g+1)%d.length),4e3);return()=>clearInterval(b)},[d.length]);const w=d[m];if(!w)return null;const N=d[0].total>0?Math.max(5,Math.round(w.total/d[0].total*100)):100;return e.jsx("div",{className:"h-6 overflow-hidden max-w-[33vw] sm:max-w-[260px]",children:e.jsx("div",{className:"transition-transform duration-500",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-5 h-5 rounded-full bg-slate-700 text-xs text-slate-300 flex items-center justify-center",children:m+1}),e.jsx("span",{className:`text-sm font-semibold ${w.team.textColor}`,children:w.team.name}),e.jsx("div",{className:"flex-grow h-2 bg-slate-700 rounded-full",children:e.jsx("div",{className:"h-2 rounded-full bg-cyan-400",style:{width:`${N}%`}})}),e.jsxs("span",{className:"text-[11px] text-slate-400",children:[w.total.toLocaleString()," ",l]})]})})})},L=({challenges:t})=>{const s=t,x=s.length>0?[...s,...s]:[];return e.jsx(k,{title:"æŒ‘æˆ˜æ“‚å°",children:x.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-slate-500",children:"æš‚æ— æŒ‘æˆ˜"}):e.jsxs("div",{className:"h-full overflow-hidden relative",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-max animate-scroll-vertical",children:x.map((l,d)=>e.jsxs("div",{className:"flex items-center p-2 mb-2 bg-slate-800/40 border border-slate-700/50 rounded-lg",children:[e.jsx("img",{src:l.challenger.avatar,alt:l.challenger.name,className:"w-9 h-9 rounded-full border-2 border-purple-400 mr-3 flex-shrink-0"}),e.jsxs("div",{className:"flex-grow overflow-hidden",children:[e.jsx("h4",{className:"font-bold text-sm text-purple-300 truncate",children:l.title}),e.jsxs("p",{className:"text-xs text-slate-400 truncate",children:["æŒ‘æˆ˜è€…: ",l.challenger.name]})]}),l.status==="è¿›è¡Œä¸­"&&e.jsx("span",{className:"text-xs font-semibold bg-purple-500/50 text-purple-200 px-2 py-0.5 rounded-full ml-2",children:"è¿›è¡Œä¸­"}),l.status==="æˆåŠŸ"&&e.jsx("span",{className:"text-xs font-semibold bg-emerald-500/80 text-white px-2 py-0.5 rounded-full ml-2",children:"æˆåŠŸ"}),l.status==="å¤±è´¥"&&e.jsx("span",{className:"text-xs font-semibold bg-red-500/80 text-white px-2 py-0.5 rounded-full ml-2",children:"å¤±è´¥"})]},`${l.id}-${d}`))}),e.jsx("style",{children:`
            @keyframes scroll-vertical {
              from { transform: translateY(0); }
              to { transform: translateY(-50%); }
            }
            .animate-scroll-vertical {
              /* Adjust duration based on content height */
              animation: scroll-vertical ${s.length*5}s linear infinite;
            }
          `})]})})},O=({student:t,badge:s})=>{const x=l=>{if(!l)return"";const d=new Date(l),m=d.getFullYear(),v=`${d.getMonth()+1}`.padStart(2,"0"),w=`${d.getDate()}`.padStart(2,"0");return`${m}-${v}-${w}`};return e.jsxs("div",{className:"relative w-72 h-48 flex-shrink-0 bg-slate-800/60 backdrop-blur-md border border-yellow-500/30 rounded-lg shadow-md p-4 flex flex-col justify-between text-white mx-4 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none select-none z-0",children:e.jsx("span",{className:"text-8xl font-black text-slate-500 opacity-30 transform -rotate-12 blur-sm",children:s.name})}),e.jsxs("div",{className:"relative z-10 flex flex-col justify-between h-full",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("img",{src:s.image,alt:s.name,className:"w-20 h-20 rounded-full border-2 border-yellow-400 object-cover"}),e.jsxs("div",{className:"flex-1 text-right",children:[e.jsx("h3",{className:"text-lg font-bold",children:t.name}),e.jsx("p",{className:"text-md font-semibold text-yellow-300",children:s.name})]})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-slate-300 italic line-clamp-2",children:['"',s.description,'"']}),e.jsxs("div",{className:"border-t border-slate-700 mt-2 pt-2 text-xs text-slate-400 text-right",children:["åŠ å†•äº: ",x(s.awardedDate)]})]})]})]})},U=({students:t})=>{const s=i.useMemo(()=>t.filter(l=>l.badges&&l.badges.length>0).flatMap(l=>l.badges.map(d=>({student:l,badge:d,key:`${l.id}-${d.id}`}))).sort((l,d)=>{const m=new Date(l.badge.awardedDate||0).getTime();return new Date(d.badge.awardedDate||0).getTime()-m}),[t]);if(s.length===0)return null;const x=[...s,...s];return e.jsxs("div",{className:"relative w-full overflow-hidden group h-52 -mb-2 pt-2 border-t-2 border-yellow-400/50 shadow-[0_-5px_25px_-5px_rgba(250,204,21,0.3)]",children:[e.jsx("div",{className:"absolute top-0 left-0 w-24 h-full bg-gradient-to-r from-gray-900 to-transparent z-10"}),e.jsx("div",{className:"absolute top-0 right-0 w-24 h-full bg-gradient-to-l from-gray-900 to-transparent z-10"}),e.jsx("div",{className:"flex absolute top-4 left-0 w-max animate-scroll group-hover:pause",children:x.map(({student:l,badge:d,key:m},v)=>e.jsx(O,{student:l,badge:d},`${m}-${v}`))}),e.jsx("style",{children:`
            @keyframes scroll {
                from { transform: translateX(0); }
                to { transform: translateX(-50%); }
            }
            .animate-scroll {
                animation: scroll 120s linear infinite;
            }
            .pause {
                animation-play-state: paused;
            }
        `})]})},M=t=>t.length>4?t.slice(0,4):t,F=({pks:t,teamsMap:s,students:x=[]})=>{const l=i.useMemo(()=>{const h=new Map;return x.forEach(f=>h.set(String(f.id),f)),h},[x]),d=i.useRef(null),[m,v]=i.useState(6),[w,N]=i.useState(0),[b,g]=i.useState(!0),j=i.useMemo(()=>{const h=[];for(let f=0;f<t.length;f+=m)h.push(t.slice(f,f+m));return h.length>0?h:[[]]},[t,m]),_=i.useMemo(()=>j.length<=1?j:[...j,j[0]],[j]);return i.useEffect(()=>{N(0),g(!0)},[t]),i.useEffect(()=>{const h=d.current;if(!h)return;const f=new ResizeObserver(()=>{const c=h.clientHeight,n=Math.max(3,Math.floor(c/(54+8)));v(n)});return f.observe(h),()=>f.disconnect()},[]),i.useEffect(()=>{if(j.length<=1)return;const h=setInterval(()=>{N(f=>{const c=f+1;return c>=_.length-1&&setTimeout(()=>{g(!1),N(0),setTimeout(()=>g(!0),50)},700),c})},4e3);return()=>clearInterval(h)},[j.length,_.length]),e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700/50 rounded-xl shadow-lg h-full flex flex-col",children:[e.jsx("h2",{className:"text-xl font-bold text-center p-3 border-b border-slate-700/50",children:"PKæ¦œ"}),e.jsx("div",{ref:d,className:"p-3 flex-grow min-h-0 overflow-hidden",children:t.length===0?e.jsx("div",{className:"h-full flex items-center justify-center text-slate-500",children:"æš‚æ—  PK æ•°æ®"}):e.jsx("div",{className:`flex h-full ${b?"transition-transform duration-700 ease-in-out":""}`,style:{transform:`translateX(-${w*100}%)`},children:_.map((h,f)=>e.jsx("ul",{className:"w-full flex-shrink-0 h-full space-y-2",children:h.map(c=>{const r=l.get(String(c.student_a)),o=l.get(String(c.student_b));s.get(c.student_a),s.get(c.student_b);const n=c.status==="finished",u=n&&!c.winner_id,a=n&&c.winner_id===c.student_a,p=n&&c.winner_id===c.student_b,S=(r==null?void 0:r.name)||`å­¦ç”Ÿ${c.student_a}`,y=(o==null?void 0:o.name)||`å­¦ç”Ÿ${c.student_b}`,$=(r==null?void 0:r.avatar_url)||`https://i.pravatar.cc/60?u=${c.student_a}`,D=(o==null?void 0:o.avatar_url)||`https://i.pravatar.cc/60?u=${c.student_b}`;return e.jsx("li",{className:"relative p-2 rounded-lg border border-slate-700/50 bg-slate-800/30",children:e.jsxs("div",{className:"grid grid-cols-3 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:$,className:"w-8 h-8 rounded-full border border-slate-600"}),e.jsx("span",{className:`text-sm font-semibold ${a?"text-emerald-400":p?"text-red-400":"text-white"}`,children:M(S)}),a&&e.jsx("span",{className:"ml-1 px-1.5 py-0.5 text-[10px] font-bold bg-emerald-500/80 text-white rounded",children:"èƒœ"}),p&&e.jsx("span",{className:"ml-1 px-1.5 py-0.5 text-[10px] font-bold bg-red-500/70 text-white rounded",children:"è´Ÿ"})]}),e.jsxs("div",{className:"flex items-center justify-center flex-col",children:[u?e.jsx("span",{className:"text-xs font-bold text-yellow-400",children:"å¹³å±€"}):n?e.jsx("span",{className:"text-xs text-slate-500",children:"VS"}):e.jsx("span",{className:"text-xs font-bold text-blue-400",children:"PKä¸­"}),e.jsx("span",{className:"mt-1 text-[11px] text-slate-400 truncate max-w-[140px]",children:c.topic})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[p&&e.jsx("span",{className:"mr-1 px-1.5 py-0.5 text-[10px] font-bold bg-emerald-500/80 text-white rounded",children:"èƒœ"}),a&&e.jsx("span",{className:"mr-1 px-1.5 py-0.5 text-[10px] font-bold bg-red-500/70 text-white rounded",children:"è´Ÿ"}),e.jsx("span",{className:`text-sm font-semibold ${p?"text-emerald-400":a?"text-red-400":"text-white"}`,children:M(y)}),e.jsx("img",{src:D,className:"w-8 h-8 rounded-full border border-slate-600"})]})]})},c.id)})},f))})})]})},K=[{id:"t1",name:"è¶…èƒ½è‹±é›„",color:"bg-cyan-500",textColor:"text-cyan-400"},{id:"t2",name:"å¤©æ‰å°‘å¹´",color:"bg-purple-500",textColor:"text-purple-400"},{id:"t3",name:"å­¦éœ¸æ— æ•Œ",color:"bg-red-500",textColor:"text-red-400"}],W=async()=>K,X=()=>{const t=typeof window<"u"?window.location.protocol:"http:",s=typeof window<"u"?window.location.host:"localhost:3000";return`${t}//${s}/api`},C=X(),Y=()=>{const[t,s]=i.useState([]),[x,l]=i.useState([]),[d,m]=i.useState(!1),[v,w]=i.useState([]),[N,b]=i.useState([]),[g,j]=i.useState([]);i.useEffect(()=>{(async()=>{try{const o=await W();l(o)}catch(o){console.error("Failed to load teams:",o)}})()},[]),i.useEffect(()=>{const r=async()=>{try{const u=await(await fetch(`${C}/pk-matches`)).json();u.success&&Array.isArray(u.data)&&w(u.data.map(a=>({id:String(a.id),student_a:String(a.student_a),student_b:String(a.student_b),topic:a.topic,status:a.status,winner_id:a.winner_id?String(a.winner_id):void 0,updated_at:new Date().toISOString()})))}catch(n){console.error("Failed to load PK data:",n)}};r();const o=setInterval(r,5e3);return()=>clearInterval(o)},[]),i.useEffect(()=>{const r=async()=>{try{const u=await(await fetch(`${C}/challenges`)).json();u.success&&Array.isArray(u.data)&&b(u.data.map(a=>{let p="è¿›è¡Œä¸­";return a.status==="active"||a.status==="pending"?p="è¿›è¡Œä¸­":a.status==="completed"&&(a.result==="success"?p="æˆåŠŸ":a.result==="fail"?p="å¤±è´¥":p="æˆåŠŸ"),{id:String(a.id),title:a.title,description:a.description,status:p,reward_points:a.reward_points,reward_exp:a.reward_exp,challenger:{name:a.challenger_name||"æœªçŸ¥æŒ‘æˆ˜è€…",avatar:a.challenger_avatar||"https://api.dicebear.com/7.x/notionists/svg?seed=system&backgroundColor=ffffff"}}}))}catch(n){console.error("Failed to load challenge data:",n)}};r();const o=setInterval(r,5e3);return()=>clearInterval(o)},[]),i.useEffect(()=>{let r=null,o=JSON.stringify([]);const n=async()=>{try{const a=await(await fetch(`${C}/students`)).json();if(a.success&&Array.isArray(a.data)){const p=a.data.map(y=>({id:String(y.id),name:y.name,team_id:`t${y.team_id}`,total_exp:y.total_exp||0,total_points:y.score||0,avatar_url:y.avatar_url||`https://api.dicebear.com/7.x/notionists/svg?seed=${encodeURIComponent(y.name)}&backgroundColor=ffffff`,badges:(y.badges||[]).map($=>({id:String($.id),name:$.name,description:$.description||"",icon:$.icon||"ğŸ†",image:y.avatar_url||`https://api.dicebear.com/7.x/notionists/svg?seed=${encodeURIComponent(y.name)}&backgroundColor=ffffff`,awardedDate:$.awarded_at}))})),S=JSON.stringify(p);o!==S?(o=S,s(p),m(!0)):d||m(!0)}}catch(u){console.error("Polling error:",u),m(!1)}};return n(),r=setInterval(n,2e3),()=>{r&&clearInterval(r)}},[]);const _=i.useMemo(()=>new Map(x.map(r=>[r.id,r])),[x]),h=i.useMemo(()=>[...t].sort((r,o)=>o.total_exp-r.total_exp),[t]),f=i.useMemo(()=>{if(t.length<2)return[];const r=[...t].sort((n,u)=>u.total_points-n.total_points),o=[];for(let n=0;n<Math.min(6,Math.floor(r.length/2));n++){const u=r[n*2],a=r[n*2+1];o.push({id:`pk-${n}`,student_a:u.id,student_b:a.id,topic:["èƒŒå¤è¯—","é€Ÿç®—","è‹±è¯­æ‹¼å†™","æ•°å­¦ç«èµ›","å†™ä½œæ¯”èµ›","åˆ›æ„æ€ç»´"][n%6],status:n%3===0?"finished":"pending",winner_id:n%3===0?Math.random()>.5?u.id:a.id:void 0,updated_at:new Date().toISOString()})}return o},[t]),c=i.useMemo(()=>{if(t.length===0)return[];const r=[...t].sort((a,p)=>p.total_points-a.total_points),o=["ä¸€å‘¨é˜…è¯»æŒ‘æˆ˜","è‰ºæœ¯åˆ›ä½œ","æ•°å­¦é€Ÿç®—","è‹±è¯­æ¼”è®²","ç§‘å­¦å®éªŒ","ç¼–ç¨‹æŒ‘æˆ˜"],n=["è¿›è¡Œä¸­","æˆåŠŸ","å¤±è´¥"],u=[];for(let a=0;a<Math.min(5,r.length);a++){const p=r[a];u.push({id:`c-${a}`,title:o[a%o.length],description:`å®Œæˆ ${[5,10,3,2,1,8][a%6]} ä¸ªä»»åŠ¡`,challenger:{name:p.name,avatar:p.avatar_url||`https://api.dicebear.com/7.x/notionists/svg?seed=${p.name}&backgroundColor=ffffff`},status:n[a%n.length]})}return u},[t]);return i.useMemo(()=>t.length===0?[]:[...t].map((r,o)=>{const n=[];return o%3===0&&n.push({id:`b1-${o}`,name:"å­¦éœ¸ä¹‹æ˜Ÿ",description:"å­¦ä¹ è¡¨ç°çªå‡º",image:r.avatar_url||`https://api.dicebear.com/7.x/notionists/svg?seed=${r.name}&backgroundColor=ffffff`,icon:"â­",awardedDate:new Date(Date.now()-Math.random()*30*24*60*60*1e3).toISOString()}),o%4===0&&n.push({id:`b2-${o}`,name:"æŒ‘æˆ˜å…ˆé”‹",description:"å®ŒæˆæŒ‘æˆ˜æœ€å¤š",image:r.avatar_url||`https://api.dicebear.com/7.x/notionists/svg?seed=${r.name}&backgroundColor=ffffff`,icon:"ğŸ›¡ï¸",awardedDate:new Date(Date.now()-Math.random()*30*24*60*60*1e3).toISOString()}),o%5===0&&n.push({id:`b3-${o}`,name:"å…¨å‹¤å¥–",description:"æœ¬æœˆæ— ç¼ºå¸­",image:r.avatar_url||`https://api.dicebear.com/7.x/notionists/svg?seed=${r.name}&backgroundColor=ffffff`,icon:"ğŸƒ",awardedDate:new Date(Date.now()-Math.random()*30*24*60*60*1e3).toISOString()}),{...r,badges:n}}),[t]),e.jsxs("div",{className:"h-screen bg-gradient-to-br from-gray-900 via-slate-900 to-black text-white p-4 flex flex-col overflow-hidden",children:[e.jsx(A,{wsConnected:d}),e.jsxs("main",{className:"mt-4 grid grid-cols-1 lg:grid-cols-3 gap-6 flex-grow min-h-0",children:[e.jsx("div",{className:"lg:col-span-2 h-full min-h-0",children:e.jsx(k,{title:"ç­‰çº§å¤§å…",rightSlot:e.jsx(H,{students:t,teams:x,sortBy:"total_exp",unit:"ç»éªŒ"}),children:e.jsx(z,{students:h,teamsMap:_,onAvatarChange:()=>{}})})}),e.jsxs("div",{className:"lg:col-span-1 flex flex-col gap-6 h-full min-h-0",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(F,{pks:v.length>0?v:f,teamsMap:_,students:t})}),e.jsx("div",{className:"flex-grow min-h-0",children:e.jsx(L,{challenges:N.length>0?N:c})})]})]}),e.jsx("div",{className:"mt-4 grid grid-cols-1 gap-6 flex-shrink-0",children:e.jsx("div",{className:"col-span-1",children:e.jsx(U,{students:t})})})]})},G=R.createRoot(document.getElementById("root"));G.render(e.jsx(Y,{}));
