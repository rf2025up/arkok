# 分组管理功能文档

## 功能概述

学生积分管理系统现已支持 **分组功能**，允许你：
- 🏷️ 创建多个分组（如：A班、B班、重点班等）
- ✏️ 编辑分组名称和颜色
- 👥 为每个学生手动分配分组
- 🎨 每个分组拥有独特的颜色标识
- 🗑️ 删除空分组

## 数据库结构

### groups 表
```sql
CREATE TABLE groups (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL UNIQUE,          -- 分组名称
    display_order INTEGER NOT NULL DEFAULT 0,   -- 显示顺序
    color VARCHAR(7) DEFAULT '#667eea',         -- 分组颜色（十六进制）
    created_at TIMESTAMP DEFAULT NOW(),         -- 创建时间
    updated_at TIMESTAMP DEFAULT NOW()          -- 更新时间
);
```

### students 表扩展
```sql
ALTER TABLE students
ADD COLUMN group_id INTEGER REFERENCES groups(id) ON DELETE SET NULL;
```

## API 端点

### 获取所有分组
```
GET /api/groups
Response:
{
    "success": true,
    "data": [
        {
            "id": 1,
            "name": "A班",
            "display_order": 1,
            "color": "#667eea",
            "created_at": "2025-11-21T10:00:00.000Z",
            "updated_at": "2025-11-21T10:00:00.000Z"
        }
    ]
}
```

### 创建分组
```
POST /api/groups
Body:
{
    "name": "新分组",
    "color": "#667eea"  // 可选，默认为 #667eea
}
Response:
{
    "success": true,
    "data": { ... 新分组信息 ... }
}
```

### 更新分组
```
PUT /api/groups/:id
Body:
{
    "name": "更新的名称",      // 可选
    "color": "#764ba2",        // 可选
    "display_order": 2         // 可选
}
Response:
{
    "success": true,
    "data": { ... 更新后的分组信息 ... }
}
```

### 删除分组
```
DELETE /api/groups/:id
Response:
{
    "success": true,
    "message": "删除成功",
    "data": { ... 已删除的分组信息 ... }
}
```
**注意**：分组中有学生时无法删除

## 前端功能

### 📱 管理后台 (admin.html)

#### 1. 分组管理标签页
- 位置：头部标签页中的 "分组管理"
- 功能：
  - **创建分组**：输入分组名称和选择颜色，点击 "创建分组"
  - **编辑分组**：点击分组行右侧的 "编辑" 按钮
  - **删除分组**：点击分组行右侧的 "删除" 按钮（仅当分组为空时可用）

#### 2. 学生编辑中添加分组选择
- 编辑学生时，新增 "分组" 下拉框
- 创建学生时，新增 "分组" 下拉框（可选）
- 学生列表中显示所属分组

### 🖥️ 大屏展示 (display.html)

#### 动态分组显示
- **如果有分组**：按分组显示排行榜，每个分组独立计算排名
  - 分组名称显示在顶部
  - 分组颜色作为品牌色
  - 响应式布局：根据分组数量自动调整列数

- **如果没有分组**：
  - 回退到原始的 3 组分割模式
  - 保持原有的排名逻辑

#### 示例布局
```
大屏展示（假设有3个分组：A班、B班、C班）

┌─────────────────────────────────────────────┐
│       🏆 学生积分排行榜                      │
│  总学生数: 30  平均积分: 85  最高: 100  最低: 60 │
├─────────────────────────────────────────────┤
│  ┌───────────┐  ┌───────────┐  ┌───────────┐ │
│  │   A班     │  │   B班     │  │   C班     │ │
│  ├───────────┤  ├───────────┤  ├───────────┤ │
│  │🥇 张三 95 │  │🥇 李四 92 │  │🥇 王五 88 │ │
│  │🥈 赵六 90 │  │🥈 孙七 87 │  │🥈 周八 85 │ │
│  │🥉 吴九 85 │  │🥉 郑十 82 │  │🥉 何冬 80 │ │
│  └───────────┘  └───────────┘  └───────────┘ │
└─────────────────────────────────────────────┘
```

## 工作流程

### 1️⃣ 初始化分组
```bash
# 运行迁移脚本会自动创建 3 个默认分组
node update-db.js

# 输出：
# 🔄 开始数据库迁移...
# 📋 创建 groups 表...
# ✅ groups 表创建成功
# 📋 为 students 表添加 group_id 字段...
# ✅ group_id 字段添加成功
# 📋 创建默认分组...
#   ✅ 分组 "A班" 创建成功
#   ✅ 分组 "B班" 创建成功
#   ✅ 分组 "C班" 创建成功
# 📋 为现有学生分配默认分组...
# ✅ 为 6 个学生分配了分组
```

### 2️⃣ 管理分组
在管理后台的 "分组管理" 标签页：
- ✅ 创建新分组
- ✅ 编辑分组名称和颜色
- ✅ 删除空分组

### 3️⃣ 分配学生
在 "学生列表" 标签页：
- ✅ 添加学生时选择分组
- ✅ 编辑学生时更改分组
- ✅ 快速查看学生所属分组

### 4️⃣ 查看排行榜
访问大屏展示：
- ✅ 按分组显示排行榜
- ✅ 每个分组独立排名
- ✅ 实时数据同步

## 使用示例

### 场景 1：班级区分
```
A班：一年级 A 班学生
B班：一年级 B 班学生
C班：一年级 C 班学生
```

### 场景 2：能力分班
```
重点班：成绩优秀学生
普通班：成绩一般学生
基础班：成绩待提升学生
```

### 场景 3：兴趣分班
```
数学小组
语文小组
英语小组
```

## 技术细节

### 动态分组特性
1. **颜色识别**：每个分组拥有独特的 16 进制颜色代码
2. **自动排序**：分组按 `display_order` 字段排序显示
3. **级联删除**：删除分组时，该分组下的学生 `group_id` 设置为 NULL
4. **动态渲染**：大屏展示根据分组数量自动调整布局

### 响应式设计
```css
/* 超大屏：多列显示分组 */
@media (min-width: 1200px) {
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
}

/* 平板：2 列显示 */
@media (max-width: 1200px) {
    grid-template-columns: repeat(2, 1fr);
}

/* 手机：单列显示 */
@media (max-width: 768px) {
    grid-template-columns: 1fr;
}
```

## 后续扩展

### 可选功能
- [ ] 分组权限管理
- [ ] 分组的积分统计（总分、人均）
- [ ] 分组排名（哪个班级总分最高）
- [ ] 导出按分组的成绩单
- [ ] 分组间的排行榜对比
- [ ] 分组学生的批量操作

## 故障排查

### 问题 1：无法删除分组
**原因**：分组中还有学生
**解决**：将该分组下的所有学生重新分配到其他分组，或删除这些学生

### 问题 2：大屏展示没有按分组显示
**原因**：可能是浏览器缓存或数据未加载
**解决**：
1. 刷新页面（Ctrl+F5 强制刷新）
2. 检查浏览器控制台是否有错误
3. 确保至少有一个分组存在

### 问题 3：添加学生时看不到分组下拉框
**原因**：分组未加载完成
**解决**：刷新页面或稍等几秒

---

**创建时间**: 2025-11-21
**版本**: 1.0.0
**状态**: ✅ 已实现
