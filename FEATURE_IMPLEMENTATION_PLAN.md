# 功能实现计划 - 星途成长方舟增强版

**计划日期：** 2024年11月22日
**状态：** 规划中

---

## 📋 功能需求清单

### 第一阶段：认证系统 (Feature 1)

#### 1.1 登陆验证页面
**需求：**
- 手机注册、邮件注册、微信注册（保留接口，暂不对接）
- 密码找回
- 所有人登陆都是 admin，密码 1234
- 当前无需外部验证

**实现范围：**
- [ ] 创建登陆页面组件
- [ ] 实现三种注册方式 UI
- [ ] 实现密码找回 UI
- [ ] 虚拟认证逻辑（admin/1234）
- [ ] 登陆状态管理和 token
- [ ] 页面路由保护

**预计工时：** 8 小时
**优先级：** 高（基础功能）

---

### 第二阶段：战队信息管理 (Features 2, 部分)

#### 2.1 战队系统优化
**需求：**
- 手机端新增战队：超能英雄、天才少年、学霸无敌
- 大屏端删除战队信息，沿用手机端战队
- 修复：手机端经验值与数据库打通问题

**实现范围：**
- [ ] 更新战队数据表
- [ ] 手机端战队下拉选择更新
- [ ] 大屏端移除战队显示
- [ ] 修复经验值数据同步问题
- [ ] 验证手机端操作后学生卡经验值更新

**预计工时：** 4 小时
**优先级：** 高

---

### 第三阶段：个人信息管理 (Feature 3)

#### 3.1 班级页面头像/姓名编辑
**需求：**
- 班级中点击头像可编辑姓名
- 保存功能
- 实时更新显示

**实现范围：**
- [ ] 创建编辑模态框组件
- [ ] 姓名输入字段
- [ ] 保存到数据库
- [ ] 前端实时更新

**预计工时：** 3 小时
**优先级：** 中

---

### 第四阶段：班级预设 (Feature 4)

#### 4.1 班级默认值
**需求：**
- 班级默认：黄老师班、姜老师班、龙老师班
- 需要在班级选择下拉中体现

**实现范围：**
- [ ] 数据库添加默认班级
- [ ] 班级下拉初始化
- [ ] 前端显示

**预计工时：** 2 小时
**优先级：** 低

---

### 第五阶段：积分管理系统优化 (Feature 5)

#### 5.1 班级积分页面重构
**需求：**
- 预设改成"新增"
- 删掉"预设2"文字
- 积分名称与数值之间删掉括号
- 积分数字用红色呈现
- 积分名称下方为输入框
- 下方分两个数字输入框：积分、经验值
- 底部保存按钮

**实现范围：**
- [ ] 重构积分页 UI 布局
- [ ] 更新样式（红色数字、无括号）
- [ ] 输入字段验证
- [ ] 保存逻辑
- [ ] 前端验证和数据库存储

**预计工时：** 6 小时
**优先级：** 高

---

### 第六阶段：学生管理优化 (Feature 6)

#### 6.1 班级管理 - 新增学生
**需求：**
- 删除学生姓名文字输入框
- 已有班级选择和战队选择下拉
- 学生姓名通过下拉选择（现有学生）

**实现范围：**
- [ ] 修改新增学生 UI
- [ ] 删除文字输入框
- [ ] 添加学生下拉选择
- [ ] 逻辑调整

**预计工时：** 3 小时
**优先级：** 中

---

### 第七阶段：挑战历史记录 (Feature 7)

#### 7.1 班级管理 - 挑战记录
**需求：**
- 挑战列表下新增"过往挑战"标签页
- 显示本周挑战记录
- 独立的列表记录

**实现范围：**
- [ ] 创建挑战历史数据表
- [ ] 挑战页面添加标签页组件
- [ ] 本周挑战记录查询逻辑
- [ ] 历史列表显示

**预计工时：** 5 小时
**优先级：** 中

---

### 第八阶段：PK系统增强 (Feature 8)

#### 8.1 班级管理 - PK页面增强
**需求：**
- 在 PK 列表中部添加"平"按钮（黄色标签）
- 表示双方平局
- PK 参与自动扣除学生 50 积分
- PK 参与自动增加学生 200 经验值
- 添加获胜奖励输入框（积分+经验值）
- 获胜方自动获得奖励

**实现范围：**
- [ ] 添加"平"按钮到 PK 列表 UI
- [ ] 平局状态管理
- [ ] 参与 PK 时的积分/经验扣除逻辑
- [ ] 获胜奖励输入框 UI
- [ ] 获胜奖励分配逻辑
- [ ] 大屏端同步更新（显示"平"标签）
- [ ] 积分/经验值实时更新

**预计工时：** 8 小时
**优先级：** 高

---

### 第九阶段：进度条系统 (Feature 9)

#### 9.1 大屏端 - 经验值进度条
**需求：**
- 进度条与学生经验值绑定
- 根据游戏化升级方式，逐级增加升级所需经验
- 进度条根据经验值变化

**实现范围：**
- [ ] 设计升级经验曲线（推荐：100, 250, 450, 700...）
- [ ] 计算当前等级和进度
- [ ] 大屏端进度条组件
- [ ] 经验值变化时自动更新
- [ ] 升级效果和动画

**预计工时：** 6 小时
**优先级：** 高

---

### 第十阶段：打卡系统优化 (Feature 10)

#### 10.1 手机端 - 习惯打卡改进
**需求：**
- 打卡数据显示在个人信息卡中
- 优化打卡成功反馈方式
- 参考积分操作的反馈

**实现范围：**
- [ ] 打卡记录数据表设计
- [ ] 打卡数据与学生表关联
- [ ] 个人信息卡显示打卡数据
- [ ] 打卡成功反馈 UI/UX
- [ ] 打卡成功后数据同步

**预计工时：** 5 小时
**优先级：** 中

---

### 第十一阶段：多校区隔离 (Feature 11 - 仅规划)

#### 11.1 多校区架构设计
**需求：**
- 完成第 1-10 功能后再实施
- 校区隔离方案

**预计工时：** 待完成第 1-10 后评估
**优先级：** 低（后期）

**初步设计方向：**
- 数据库：添加 school_id 字段到所有数据表
- 认证：登陆时选择校区或绑定校区
- API：所有查询自动过滤校区数据
- 前端：校区选择器或自动识别

---

## 📊 实现计划时间表

| 阶段 | 功能 | 工时 | 开始 | 完成 | 状态 |
|------|------|------|------|------|------|
| 1 | 登陆认证系统 | 8h | - | - | 待开始 |
| 2 | 战队系统优化 | 4h | - | - | 待开始 |
| 3 | 个人信息编辑 | 3h | - | - | 待开始 |
| 4 | 班级预设 | 2h | - | - | 待开始 |
| 5 | 积分管理重构 | 6h | - | - | 待开始 |
| 6 | 学生管理优化 | 3h | - | - | 待开始 |
| 7 | 挑战历史记录 | 5h | - | - | 待开始 |
| 8 | PK系统增强 | 8h | - | - | 待开始 |
| 9 | 进度条系统 | 6h | - | - | 待开始 |
| 10 | 打卡系统优化 | 5h | - | - | 待开始 |
| **总计** | | **50h** | | | |

**总预计工时：** 50 小时（约 1-2 周，每天 8 小时）

---

## 🏗️ 技术实现方案

### 后端需求

**新增数据表：**
1. `users` - 用户认证表
   - id, username, password_hash, email, phone, auth_type, created_at

2. `challenge_history` - 挑战历史表
   - id, student_id, challenge_id, result, created_at

3. `pk_history` - PK历史表
   - id, student_a_id, student_b_id, result, reward_points, reward_exp, created_at

**修改的数据表：**
1. `students` - 添加 check_in_count（打卡次数）
2. `teams` - 添加新的战队数据

**新增 API 端点：**
- POST `/auth/login` - 登陆
- POST `/auth/register` - 注册
- POST `/auth/forgot-password` - 密码找回
- PUT `/students/:id/name` - 修改学生姓名
- POST `/students/:id/checkin` - 打卡
- GET `/students/:id/checkin-history` - 打卡历史
- POST `/pk/participate` - 参与 PK
- PUT `/pk/:id/draw` - PK 平局
- GET `/challenges/history` - 挑战历史
- POST `/scores/preset` - 创建积分预设

---

### 前端需求

**新建组件：**
- `LoginPage` - 登陆页面
- `RegisterModal` - 注册模态框
- `ForgotPasswordModal` - 找回密码模态框
- `StudentNameEditor` - 学生姓名编辑
- `ChallengeHistory` - 挑战历史
- `PKRewardInput` - PK奖励输入
- `ProgressBar` - 经验值进度条
- `CheckinFeedback` - 打卡反馈

**修改的组件：**
- `ClassManage` - 添加登陆检查
- `ScorePreset` - 重构 UI
- `PKBoard` - 添加"平"功能和奖励
- `StudentCard` - 添加打卡数据显示
- `BigscreenApp` - 显示进度条，沿用手机端战队

---

## ✅ 验证和测试清单

### 功能验证

- [ ] 登陆和认证工作正常
- [ ] 三种注册方式 UI 完整
- [ ] 战队数据正确显示
- [ ] 经验值数据同步
- [ ] 姓名编辑保存成功
- [ ] 默认班级正确加载
- [ ] 积分预设保存和显示
- [ ] 学生管理下拉选择工作
- [ ] 挑战历史只显示本周
- [ ] PK 平局功能工作
- [ ] 参与 PK 积分/经验扣除正确
- [ ] 获胜奖励分配正确
- [ ] 进度条随经验值变化
- [ ] 打卡数据显示和反馈

### 数据一致性

- [ ] 手机端修改后大屏同步
- [ ] 数据库和前端数据一致
- [ ] 积分/经验值计算正确
- [ ] 历史记录完整

### 用户体验

- [ ] 操作反馈清晰
- [ ] 加载速度可接受
- [ ] 移动设备适配
- [ ] 无崩溃或错误

---

## 📝 实现顺序建议

**建议优先级顺序（从高到低）：**

1. **第 1 阶段** - 登陆系统（基础，其他功能依赖）
2. **第 2 阶段** - 战队系统（影响多个模块）
3. **第 5 阶段** - 积分管理（核心功能）
4. **第 8 阶段** - PK 增强（复杂业务逻辑）
5. **第 9 阶段** - 进度条（大屏端重要）
6. **第 3 阶段** - 个人编辑（独立功能）
7. **第 10 阶段** - 打卡优化（用户体验）
8. **第 7 阶段** - 挑战历史（数据记录）
9. **第 6 阶段** - 学生管理（UI 优化）
10. **第 4 阶段** - 班级预设（配置性）

---

## 🔄 交付流程

### 每个阶段完成后：
1. 代码审查
2. 功能测试
3. 数据验证
4. 文档更新
5. 用户反馈收集

### 所有阶段完成后：
1. 全系统集成测试
2. 性能优化
3. 安全审计
4. 生产部署
5. 用户培训文档

---

## 💾 后续多校区规划（Feature 11）

**暂定方案（待完成第 1-10 后详细规划）：**

### 数据隔离层级

**L1 - 数据库级别：**
- 每个数据表添加 `school_id` 字段
- 所有查询自动过滤 school_id

**L2 - API 级别：**
- 从 token 中获取 user_school_id
- API 自动验证和过滤数据

**L3 - 前端级别：**
- 登陆时选择校区
- 所有请求自动附带 school_id
- 不同校区显示隔离的数据

### 初步工作量评估
- 数据库迁移：8 小时
- 后端修改：12 小时
- 前端修改：8 小时
- 测试验证：6 小时
- **总计：** 约 34 小时

---

## 📞 沟通和反馈

**实现过程中的沟通要点：**
1. 每个阶段完成后示例演示
2. 收集用户反馈
3. 及时调整需求
4. 记录所有变更

---

**计划创建者：** Claude Code
**最后更新：** 2024年11月22日
**状态：** 待批准

---

> 💡 **建议：** 建议按照上述优先级顺序实现，每完成一个阶段后进行验证和反馈，确保方向正确后再进行下一阶段。
